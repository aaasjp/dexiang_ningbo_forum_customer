# 操作记录功能说明

## 📋 功能概述

本次更新为论坛管理后台添加了**操作记录**功能，管理员可以查看系统所有的操作日志，支持按用户工号搜索和分页浏览。

## ✨ 功能特性

### 1. 核心功能
- ✅ 操作日志列表展示
- ✅ 用户工号搜索
- ✅ 分页功能（支持 10/20/50/100 条/页）
- ✅ 操作类型中文化显示
- ✅ 时间格式化显示
- ✅ 加载状态提示
- ✅ 响应式弹框设计

### 2. 显示字段
| 字段名 | 说明 | 宽度 |
|--------|------|------|
| 序号 | 当前页的记录序号 | 80px |
| 用户工号 | 操作用户的工号 | 120px |
| 用户姓名 | 操作用户的姓名 | 120px |
| 操作类型 | 操作类型（中文显示） | 150px |
| 操作内容 | 操作的详细描述 | 自适应 |
| IP地址 | 操作来源IP地址 | 140px |
| 操作时间 | 操作发生的时间 | 180px |

### 3. 操作类型映射
系统自动将操作类型代码转换为中文：

| 操作类型代码 | 中文显示 |
|-------------|----------|
| question_delete | 删除问题 |
| question_create | 创建问题 |
| question_update | 更新问题 |
| answer_delete | 删除回答 |
| answer_create | 创建回答 |
| answer_update | 更新回答 |
| comment_delete | 删除评论 |
| comment_create | 创建评论 |
| user_forbidden | 禁用用户 |
| user_unforbidden | 启用用户 |
| points_adjust | 调整积分 |
| role_change | 变更角色 |
| admin_add | 添加管理员 |
| admin_remove | 移除管理员 |

## 📦 文件清单

### 新增文件

1. **组件文件**
   - `/src/components/LogsDialog.vue` - 操作记录弹框组件
   - `/src/components/LogsDialog.md` - 组件使用文档

2. **页面文件**
   - `/src/views/Logs.vue` - 操作记录页面

3. **API 文件**（已存在）
   - `/src/api/logs.js` - 操作日志API接口

4. **文档文件**
   - `/操作记录功能说明.md` - 本文档

### 修改文件

1. **路由配置**
   - `/src/router/index.js` - 添加操作记录路由

2. **导航菜单**
   - `/src/components/Layout.vue` - 添加操作记录菜单项

## 🚀 使用方法

### 方式一：通过导航菜单访问

1. 启动后台管理系统
2. 在左侧导航菜单中点击 **"操作记录"**
3. 进入操作记录页面
4. 点击 **"查看操作记录"** 按钮打开弹框

### 方式二：在任意页面中使用弹框组件

```vue
<template>
  <div>
    <!-- 触发按钮 -->
    <el-button @click="openLogsDialog">查看操作记录</el-button>
    
    <!-- 操作记录弹框 -->
    <LogsDialog 
      v-model="logsDialogVisible"
      title="操作记录"
      width="1200px"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import LogsDialog from '@/components/LogsDialog.vue'

const logsDialogVisible = ref(false)

const openLogsDialog = () => {
  logsDialogVisible.value = true
}
</script>
```

## 🔍 搜索功能

### 按用户工号搜索
1. 在弹框顶部的搜索框中输入用户工号
2. 点击 **"搜索"** 按钮或按下 **Enter** 键
3. 系统将筛选出该用户的所有操作记录

### 清空搜索
1. 点击搜索框右侧的清除按钮（×）
2. 点击 **"搜索"** 按钮刷新全部数据

## 📄 分页功能

### 切换每页显示数量
- 在分页器的下拉框中选择：10、20、50 或 100 条/页
- 系统自动刷新数据

### 翻页
- 点击页码或使用 **"上一页"** / **"下一页"** 按钮
- 系统自动加载对应页的数据

## 🔌 API 接口

### 接口信息
- **接口地址**: `GET /api/admin/logs/list`
- **接口文档**: `/docs/API_DOCUMENTATION.md` 第 9.14 节

### 请求参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_code | string | 否 | 用户工号 |
| operation_type | string | 否 | 操作类型 |
| start_time | datetime | 否 | 开始时间 |
| end_time | datetime | 否 | 结束时间 |
| page | int | 否 | 页码，默认1 |
| page_size | int | 否 | 每页大小，默认100 |

### 响应数据
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "items": [
      {
        "log_id": 1,
        "user_code": "001",
        "user_name": "张三",
        "operation_type": "question_delete",
        "target_type": "question",
        "target_id": 1,
        "content": "删除问题：问题标题",
        "ip_address": "192.168.1.1",
        "user_agent": "Mozilla/5.0...",
        "create_time": "2024-01-01T10:00:00"
      }
    ],
    "total": 100
  }
}
```

## 🎨 样式说明

### 设计规范
组件样式完全遵循现有页面的设计规范：

1. **弹框尺寸**
   - 默认宽度：1200px
   - 最大高度：90vh（视口高度的90%）
   - 圆角：8px

2. **颜色规范**
   - 主色调：#FF7800（橙色）
   - 文本主色：#1a1a1a
   - 文本次色：#595959
   - 边框颜色：#f0f0f0
   - 背景色：#ffffff

3. **组件高度**
   - 搜索框：44px
   - 按钮：44px
   - 表格行：自适应内容

4. **间距规范**
   - 外边距：24px
   - 内边距：40px
   - 元素间距：12px

### 响应式设计
- 弹框高度自适应内容
- 表格支持横向滚动
- 超长文本自动省略并显示提示

## ⚙️ 配置项

### LogsDialog 组件 Props

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| modelValue | Boolean | false | 控制弹框显示/隐藏 |
| title | String | '操作记录' | 弹框标题 |
| width | String | '1200px' | 弹框宽度 |

### LogsDialog 组件 Events

| 事件名 | 参数 | 说明 |
|--------|------|------|
| update:modelValue | value: Boolean | 弹框显示状态变化 |
| cancel | - | 点击取消或关闭按钮 |

## 🔒 权限说明

- 操作记录功能需要**管理员权限**
- 接口调用需要有效的 `gw_session` token
- 普通用户无法访问此功能

## 📝 开发说明

### 扩展建议

如需进一步扩展功能，可以考虑：

1. **高级筛选**
   - 添加操作类型下拉筛选
   - 添加时间范围选择器
   - 添加多条件组合查询

2. **数据导出**
   - 导出当前页数据
   - 导出全部筛选数据
   - 支持 Excel/CSV 格式

3. **详情查看**
   - 点击记录查看详细信息
   - 显示完整的 User Agent
   - 显示操作前后对比

4. **统计分析**
   - 操作频率统计
   - 用户活跃度分析
   - 操作类型分布图表

### 代码结构

```
src/
├── api/
│   └── logs.js                 # API 接口
├── components/
│   ├── Layout.vue              # 主布局（已更新）
│   ├── LogsDialog.vue          # 操作记录弹框（新增）
│   └── LogsDialog.md           # 组件文档（新增）
├── views/
│   └── Logs.vue                # 操作记录页面（新增）
└── router/
    └── index.js                # 路由配置（已更新）
```

## 🧪 测试建议

### 功能测试
1. ✅ 弹框打开/关闭功能
2. ✅ 数据加载和显示
3. ✅ 用户工号搜索
4. ✅ 分页切换
5. ✅ 每页数量切换
6. ✅ 操作类型显示正确
7. ✅ 时间格式化正确
8. ✅ 空数据状态显示

### 兼容性测试
1. ✅ Chrome 浏览器
2. ✅ Firefox 浏览器
3. ✅ Safari 浏览器
4. ✅ Edge 浏览器

### 性能测试
1. ✅ 大量数据加载（1000+ 条）
2. ✅ 快速切换分页
3. ✅ 频繁搜索操作

## 📞 技术支持

如有问题或建议，请联系开发团队。

---

**版本**: v1.0.0  
**更新时间**: 2025-11-10  
**开发者**: AI Assistant



