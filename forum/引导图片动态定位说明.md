# 引导图片动态定位功能说明

## 功能概述

引导图片现在能够动态定位到"未解决"按钮的位置，而不是简单的居中显示。

## 实现原理

### 1. PostContent 组件改造

在 `PostContent.vue` 中：
- 为"解决状态"按钮添加 `ref="solveStatusBtn"`
- 使用 `defineExpose` 暴露该 ref 给父组件使用

```vue
<template>
  <div 
    ref="solveStatusBtn"
    class="solve-status" 
    :class="{ clickable: canChangeSolveStatus }"
  >
    <span :class="['status-text', { solved: solved }]">
      {{ solved ? '已解决' : '未解决' }}
    </span>
  </div>
</template>

<script setup>
const solveStatusBtn = ref<HTMLElement>()

defineExpose({
  solveStatusBtn
})
</script>
```

### 2. 详情页动态定位

在 `detail.vue` 中：

#### 2.1 获取 PostContent 组件引用
```vue
<PostContent
  ref="postContentRef"
  ...
/>
```

#### 2.2 计算引导位置
```javascript
// 计算引导位置
const calculateGuidePosition = () => {
  nextTick(() => {
    const solveBtn = postContentRef.value?.solveStatusBtn
    if (solveBtn) {
      const rect = solveBtn.getBoundingClientRect()
      // 将引导图片定位到按钮位置
      guidePositionStyle.value = {
        position: 'absolute',
        top: `${rect.top}px`,
        left: `${rect.left}px`
      }
    }
  })
}
```

#### 2.3 显示引导时调用定位
```javascript
onMounted(async () => {
  await loadDepartmentData()
  await loadPostData()
  
  if (isOwnPost.value && postData.value.category === 'help') {
    const guideShown = localStorage.getItem('guideShown')
    if (!guideShown) {
      setTimeout(() => {
        showGuide.value = true
        calculateGuidePosition()  // 计算位置
      }, 1000)
    }
  }
})
```

### 3. 模板应用动态样式

```vue
<div class="guide-wrapper" :style="guidePositionStyle">
  <img src="..." class="guide-image" />
  <button class="guide-know-btn" @click="closeGuide">我知道了</button>
</div>
```

## 定位逻辑

1. 使用 `getBoundingClientRect()` 获取按钮的实际位置
2. 将引导图片的 wrapper 设置为 `absolute` 定位
3. 使用按钮的 `top` 和 `left` 坐标作为引导的起始位置
4. 引导图片和"我知道了"按钮垂直排列，自动显示在按钮位置

## 样式配置

### 引导图片
- 宽度：275px
- 高度：206px
- object-fit: contain（保持比例）

### "我知道了"按钮
- 宽度：90px
- 高度：32px
- 边框：1px solid #FAFAFA
- 颜色：#FAFAFA (白色)
- 字号：13px
- 透明背景

### 布局
- 图片和按钮垂直排列（flex-direction: column）
- 间距：20px
- 水平居中对齐

## 注意事项

1. **使用 nextTick**：确保 DOM 已渲染完成后再获取位置
2. **可选链操作符**：使用 `?.` 防止组件未加载时出错
3. **延迟显示**：1秒延迟确保页面布局稳定
4. **响应式考虑**：如果页面滚动或调整大小，位置可能需要重新计算

## 测试方法

```javascript
// 浏览器控制台清除引导标记
localStorage.removeItem('guideShown')

// 刷新页面，引导应该显示在"未解决"按钮位置
```

## 后续优化建议

1. 监听窗口 resize 事件，动态调整位置
2. 监听页面滚动，保持引导相对位置
3. 添加动画效果，让引导更自然地出现
4. 考虑不同屏幕尺寸下的自适应调整

