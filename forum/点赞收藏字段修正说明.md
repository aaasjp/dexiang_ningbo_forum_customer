# 点赞和收藏字段修正说明

## 修改概述

根据API接口规范，统一了点赞和收藏的字段命名：
- **`is_liked`**：表示当前用户是否已经点赞（布尔值）
- **`is_favorited`**：表示当前用户是否已经收藏（布尔值）

前端显示时映射为：
- `is_liked` → `liked` (问题/回答)
- `is_favorited` → `collected` (问题) / `favorited` (回答)

## 修改文件清单

### 1. API类型定义

#### `/src/api/question.ts`
- **QuestionDetail** 接口：添加 `is_liked: boolean` 和 `is_favorited: boolean` 字段
- **QuestionItem** 接口：添加 `is_liked: boolean` 和 `is_favorited: boolean` 字段

#### `/src/api/answer.ts`
- **AnswerItem** 接口：添加 `is_liked: boolean` 和 `is_favorited: boolean` 字段

### 2. 数据转换函数

#### `/src/utils/transform.ts`

**`transformQuestionToPost`** 函数：
```typescript
liked: question.is_liked,
collected: question.is_favorited,
```

**`transformQuestionDetailToPost`** 函数：
```typescript
liked: question.is_liked,
collected: question.is_favorited,
```

**`transformAnswerToComment`** 函数：
```typescript
liked: answer.is_liked,
favorited: answer.is_favorited,
```

**`transformAnswerToCommentReply`** 函数：
```typescript
liked: answer.is_liked,
```

### 3. 页面组件修改

#### `/src/pages/profile/user.vue`
1. 在回答列表映射中添加点赞和收藏状态：
   ```typescript
   liked: a.is_liked,
   collected: a.is_favorited,
   ```

2. 修复点赞处理逻辑，确保同时更新 `is_liked` 状态和 `like_count` 数量：
   ```typescript
   userQuestions.value[postIndex].is_liked = response.data.liked
   ```

#### `/src/pages/profile/index.vue`
修复点赞处理逻辑，确保同时更新 `is_liked` 状态和 `like_count` 数量：
```typescript
myQuestions.value[postIndex].is_liked = response.data.liked
```

## 涉及的功能点

### 问题列表（PostCard）
- ✅ 显示点赞状态（liked）
- ✅ 显示点赞数量（likes）
- ✅ 点赞/取消点赞操作

### 问题详情页（detail.vue）
- ✅ 显示问题的点赞状态和收藏状态
- ✅ 点赞/取消点赞问题
- ✅ 收藏/取消收藏问题
- ✅ 显示评论的点赞状态
- ✅ 点赞/取消点赞评论

### 评论列表（CommentList）
- ✅ 显示评论的点赞状态
- ✅ 点赞/取消点赞评论
- ✅ 显示子回复的点赞状态

### 个人主页（profile/index.vue, user.vue）
- ✅ 显示用户提问的点赞状态
- ✅ 显示用户回答的点赞状态
- ✅ 点赞/取消点赞操作

### 首页（home/index.vue）
- ✅ 显示问题列表的点赞状态
- ✅ 点赞/取消点赞操作

### 话题详情页（topic/detail.vue）
- ✅ 显示话题下问题的点赞状态
- ✅ 点赞/取消点赞操作

## API响应字段说明

### 问题相关接口
- GET `/api/questions/detail/{questionId}` - 返回 `is_liked` 和 `is_favorited`
- GET `/api/questions/list` - 返回 `is_liked` 和 `is_favorited`
- POST `/api/questions/like/{questionId}` - 返回 `{ liked: boolean }`
- POST `/api/questions/favorite/{questionId}` - 返回 `{ favorited: boolean }`

### 回答相关接口
- GET `/api/answers/list/question/{questionId}` - 返回 `is_liked` 和 `is_favorited`
- POST `/api/answers/like/{answerId}` - 返回 `{ liked: boolean }`
- POST `/api/answers/favorite/{answerId}` - 返回 `{ favorited: boolean }`

## 数据流说明

1. **初始加载**：
   - API返回 `is_liked` 和 `is_favorited` 字段
   - 通过 `transform` 函数转换为前端 `liked` 和 `collected`/`favorited` 字段
   - 组件根据这些字段显示对应的UI状态

2. **用户操作**：
   - 用户点击点赞/收藏按钮
   - 调用对应的toggle API
   - API返回新的状态（`liked` 或 `favorited`）
   - 更新本地数据的 `is_liked` 或 `is_favorited` 字段
   - 更新对应的数量字段（`like_count` 或 `favorite_count`）
   - UI自动刷新显示新状态

## 测试要点

1. ✅ 问题列表中点赞按钮状态正确显示
2. ✅ 问题详情页点赞和收藏按钮状态正确显示
3. ✅ 评论的点赞按钮状态正确显示
4. ✅ 点赞/取消点赞后状态正确更新
5. ✅ 收藏/取消收藏后状态正确更新
6. ✅ 点赞/收藏数量正确增减
7. ✅ 刷新页面后状态保持一致

## 注意事项

1. **字段命名统一**：后端API必须返回 `is_liked` 和 `is_favorited` 字段
2. **布尔类型**：这两个字段必须是布尔类型（true/false），不能是数字（0/1）
3. **状态同步**：每次调用toggle API后，必须同时更新状态字段和数量字段
4. **数据转换**：所有从API获取的数据必须通过 `transform` 函数转换后再使用

## 修改日期

2025-11-11


