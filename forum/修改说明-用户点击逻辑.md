# 用户点击逻辑修改说明

## 修改目标

1. 如果点击的是自己，跳转到个人中心页
2. 匿名用户不可点击

## 修改内容

### 1. PostCard 组件 (`src/components/post/PostCard.vue`)

#### 功能修改：
- 在组件挂载时获取当前用户的工号（`staff_code`）
- 在 `handleAuthorClick` 函数中：
  - 判断是否为匿名帖子（`is_anonymous === 1`），如果是则不执行跳转
  - 判断点击的用户是否是自己，如果是则跳转到个人中心页 `/profile`
  - 如果是其他用户，跳转到他人主页 `/profile/home/${staffCode}`

#### 样式修改：
- 为作者信息区域添加 `.not-clickable` 类（当帖子为匿名时）
- 匿名用户的作者信息不显示鼠标手型，不显示 hover 和 active 效果

#### 代码变更：
```typescript
// 新增导入
import { ref, onMounted } from 'vue'
import { getUserProfile } from '../../api/user'

// 新增当前用户工号变量
const currentUserStaffCode = ref<string>('')

// 在 onMounted 中获取当前用户信息
onMounted(async () => {
  try {
    const res = await getUserProfile()
    if (res.code === 200) {
      currentUserStaffCode.value = res.data.staff_code
    }
  } catch (error) {
    console.error('获取用户信息失败:', error)
  }
})

// 修改 handleAuthorClick 函数
const handleAuthorClick = () => {
  // 如果是匿名帖子，不允许点击
  if (props.post.is_anonymous === 1) {
    return
  }
  
  // 使用 staff_code 或 asker_code 跳转到个人主页
  const staffCode = props.post.author.staff_code || props.post.asker_code
  if (!staffCode) {
    return
  }
  
  // 如果点击的是自己，跳转到个人中心页
  if (staffCode === currentUserStaffCode.value) {
    router.push('/profile')
  } else {
    // 否则跳转到他人主页
    router.push(`/profile/home/${staffCode}`)
  }
}
```

### 2. PostContent 组件 (`src/components/post/PostContent.vue`)

#### 功能修改：
- 新增 `isAnonymous` prop 用于标识是否为匿名帖子
- 在 `onAuthorClick` 函数中判断是否为匿名，如果是则不触发点击事件

#### 样式修改：
- 为作者信息区域添加 `.not-clickable` 类（当 `isAnonymous` 为 true 时）
- 匿名用户的作者信息不显示鼠标手型

#### 代码变更：
```typescript
// Props 中新增 isAnonymous
interface Props {
  // ... 其他 props
  isAnonymous?: boolean  // 是否匿名
}

const props = withDefaults(defineProps<Props>(), {
  // ... 其他默认值
  isAnonymous: false
})

// 修改 onAuthorClick 函数
const onAuthorClick = () => {
  // 如果是匿名帖子，不触发点击事件
  if (props.isAnonymous) {
    return
  }
  emit('author-click')
}
```

### 3. 帖子详情页 (`src/pages/post/detail.vue`)

#### 功能修改：
- 从 API 获取当前用户的工号，而不是硬编码
- 修改 `goToUserProfile` 函数，添加匿名判断和自己/他人判断
- 向 PostContent 组件传递 `isAnonymous` prop

#### 代码变更：
```typescript
// 导入 getUserProfile API
import { toggleFollowUser, getUserProfile } from '../../api/user'

// 修改 currentUserCode 初始值
const currentUserCode = ref('')

// 在 onMounted 中获取当前用户信息
onMounted(async () => {
  // 先获取当前用户信息
  try {
    const userRes = await getUserProfile()
    if (userRes.code === 200) {
      currentUserCode.value = userRes.data.staff_code
    }
  } catch (error) {
    console.error('获取用户信息失败:', error)
  }
  
  // ... 其他加载逻辑
})

// 修改 goToUserProfile 函数
const goToUserProfile = () => {
  // 如果是匿名帖子，不允许跳转
  if (postData.value.is_anonymous === 1) {
    return
  }
  
  // 获取作者的工号
  const staffCode = postData.value.author.staff_code || postData.value.asker_code
  if (!staffCode) {
    return
  }
  
  // 如果点击的是自己，跳转到个人中心页
  if (staffCode === currentUserCode.value) {
    router.push('/profile')
  } else {
    // 否则跳转到他人主页
    router.push(`/profile/home/${staffCode}`)
  }
}

// 在 PostContent 组件中传递 isAnonymous prop
<PostContent
  :is-anonymous="postData.is_anonymous === 1"
  @author-click="goToUserProfile"
  // ... 其他 props
/>
```

## 路由说明

- 个人中心页：`/profile`
- 他人主页：`/profile/home/${staffCode}`

## 测试要点

1. **正常用户点击测试**：
   - 点击自己的头像/名字，应跳转到 `/profile`
   - 点击他人的头像/名字，应跳转到 `/profile/home/${对方工号}`

2. **匿名用户测试**：
   - 匿名帖子的作者头像/名字不应显示鼠标手型
   - 点击匿名帖子的作者信息不应有任何跳转

3. **适用场景**：
   - PostCard 组件（帖子列表）
   - PostContent 组件（帖子详情页）

## 注意事项

- 匿名判断条件：`is_anonymous === 1`
- 用户工号优先从 `author.staff_code` 获取，如果没有则从 `asker_code` 获取
- 当前用户信息通过 `getUserProfile()` API 获取


